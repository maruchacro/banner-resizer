# AI Banner Resizer 仕様書

## 1. アプリケーション概要
**AI Banner Resizer** は、アップロードされた1枚の画像を元に、Google Gemini API (Generative AI) を利用して、指定された複数のアスペクト比（サイズ）のバナー画像を自動生成するWebアプリケーションです。

ユーザーは元の画像とプロンプト（指示）を入力するだけで、YouTube、Instagram、TikTokなどの各プラットフォームに最適化されたレイアウトの画像を一度に取得できます。

## 2. 技術スタック
*   **Frontend Framework**: React (Vite)
*   **Styling**: Tailwind CSS (v4)
*   **Icons**: Lucide React
*   **API**: Google Gemini API (Generative Language API)
    *   Model: `gemini-3-pro-image-preview` (画像生成)
*   **Language**: JavaScript

## 3. デザインシステム
*   **テーマ**: ダークモード
*   **カラーパレット**:
    *   背景色 (Main): `#000000` (Black)
    *   サイドバー背景: `#1a1a1a` (Dark Gray)
    *   アクセントカラー (Primary): `#2eb6aa` (Teal)
    *   テキスト色: 白 / グレー
*   **フォント**: Inter, system-ui (San-serif)

## 4. 機能詳細

### 4.1. サイドバー (操作パネル)
画面左側に配置され、画像生成に必要なすべての設定を行います。

*   **ヘッダー**: アプリタイトル "BANNER RESIZER" を表示。
*   **プロンプト入力エリア**:
    *   AIへの生成指示をテキストで入力。
    *   デフォルト値: 「コンテンツは絶対に変えないで。人物や色味もそのまま。レイアウトはいい感じに調整して配置して。」
*   **画像アップロードエリア**:
    *   ドラッグ＆ドロップまたはクリックで画像を選択。
    *   対応フォーマット: PNG, JPG
    *   最大サイズ: 10MB (クライアント側制限目安)
    *   アップロード済み画像のプレビューと削除機能。
*   **サイズ展開 (アスペクト比) 選択**:
    *   チェックボックスで生成したい比率を複数選択可能。
    *   選択肢:
        *   16:9 (YouTubeなど)
        *   4:3 (プレゼンなど)
        *   1:1 (Instagramなど)
        *   9:16 (TikTok/Reels)
        *   3:4 (スマホ閲覧)
        *   21:9 (ウルトラワイド)
*   **APIキー入力**:
    *   Google AI Studioで取得したGemini APIキーを入力するフィールド。
    *   セキュリティのため `type="password"` で表示。
*   **生成ボタン**:
    *   「一括生成する」ボタン。
    *   未入力項目がある場合は非活性化。
    *   生成中はローディングスピナーを表示。

### 4.2. メインコンテンツ (結果表示エリア)
画面右側に配置され、生成された画像をグリッド形式で表示します。

*   **初期状態**: 画像アップロードと生成を促すメッセージを表示。
*   **画像カード**:
    *   生成された画像を表示。
    *   左上にアスペクト比のタグを表示（成功時: Primary Color, 失敗時: Red）。
    *   ホバー時に「保存する」ボタンを表示（現在は右クリック保存を推奨）。
    *   **エラー表示**: 生成に失敗した場合、エラーメッセージと詳細確認用のモーダルを表示。
*   **ローディングオーバーレイ**: 生成処理中、画面全体にローディング表示を行う。

## 5. 画像生成ロジックとAPI連携

### 5.1. APIリクエストフロー
1.  ユーザーが「一括生成する」をクリック。
2.  アップロードされた画像をBase64エンコード。
3.  選択されたアスペクト比ごとに、順次APIリクエストを送信。
    *   **エンドポイント**: `https://generativelanguage.googleapis.com/v1beta/models/gemini-3-pro-image-preview:generateContent`
    *   **メソッド**: POST
    *   **ヘッダー**: `Content-Type: application/json`
    *   **クエリパラメータ**: `key={API_KEY}`
    *   **ボディ**:
        *   `contents`: プロンプトテキストとBase64画像データ。
        *   `generationConfig`: `imageConfig` にて `aspectRatio` と `imageSize` ("2K") を指定。

### 5.2. レート制限対策 (Rate Limiting Handling)
Gemini APIのレート制限（429 Too Many Requests）を回避するため、以下の対策を実装しています。

*   **順次処理 (Sequential Processing)**: 並列リクエストではなく、1つずつ順番にリクエストを処理。
*   **待機時間 (Delay)**: 各リクエストの間に **5秒間** の待機時間を設ける。
*   **エラーハンドリング**: 429エラーが発生した場合、ユーザーに「レート制限を超過しました」と明示的に通知。

## 6. ディレクトリ構造
```
/src
  ├── components/
  │   ├── Layout.jsx       # レイアウト枠組み
  │   ├── Sidebar.jsx      # サイドバーコンポーネント
  │   ├── MainContent.jsx  # (App.jsx内に実装) 結果表示エリア
  │   └── ImageCard.jsx    # 個別の画像表示カード
  ├── lib/
  │   └── utils.js         # ユーティリティ関数 (cn等)
  ├── App.jsx              # メインアプリケーションロジック
  ├── index.css            # グローバルスタイル (Tailwind)
  └── main.jsx             # エントリーポイント
```

## 7. 今後の拡張性 (TODO)
*   画像のダウンロード機能の実装（現在はブラウザ機能に依存）。
*   生成履歴の保存（ローカルストレージ等）。
*   より詳細な画像編集オプション（ネガティブプロンプトなど）。
*   APIキーの永続化（セキュリティを考慮した実装）。
